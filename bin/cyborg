#! /usr/bin/env ruby

$LOAD_PATH.unshift(File.expand_path("../lib", File.dirname(__FILE__)))

require 'optparse'
require 'cyborg'
require 'cyborg/command'
require "cyborg/command/help"

options = {
  path: '.'
}

def next_arg
  if ARGV.first && !ARGV.first.match(/^-/)
    ARGV.shift
  end
end

OptionParser.new do |opts|

  options[:help] = ARGV.shift if %w(help h).include?(ARGV.first)

  if ARGV.empty?
    options[:help] = true
  else
    options[:command] = next_arg
  end

  opts.banner = Cyborg::Help.banner(options[:command])

  if %w(n new).include? options[:command]
    options[:name] = next_arg

    opts.on("-e", "--engine ENGINE_NAME", String, "Name the engine (defaults to gem name)") do |engine|
      options[:engine] = engine
    end

    opts.on("-f", "--force", "overwrite existing files") do |val|
      options[:force] = true
    end
  end

  opts.on("-v", "--version", "Print version") do |version|
    options[:command] = 'version'
  end

  opts.on("-h", "--help", "Print this message") do |version|
    options[:help] = opts
  end

  if options[:help]
    options[:help] = opts
  end
end.parse!

Cyborg::Command.run(options)
